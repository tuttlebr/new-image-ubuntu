---
# Initial bootstrap of Python 3 installation on all hosts
- hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: install python
      raw: test -e /usr/bin/python3 || (apt -y update && apt install -y --no-install-recommends python3-minimal)
      register: output
      changed_when: output.stdout != ""


# Install necessary Python packages for future pip and setuptools requirements
- hosts: all
  become: true 
  gather_facts: true
  tasks:
    - name: force an apt update on Ubuntu
      apt:
        update_cache: yes
      when: ansible_distribution == "Ubuntu"

    - name: install python 3 libraries if python 3 is present
      package:
        name:
        - python3-setuptools
        - python3-pip
        state: present
      when: ansible_python.version.major == 3
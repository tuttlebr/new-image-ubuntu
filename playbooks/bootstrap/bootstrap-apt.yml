---
- hosts: all
  name: update apt
  become: true
  ignore_errors: true
  tags:
  - update
  tasks:
    - name: Refresh packages
      apt:
        update_cache: yes
        autoclean: yes
        autoremove: yes
        force_apt_get: yes
        force: yes
        install-recommends: no
        purge: yes
        state: build-dep
        upgrade: safe
    - name: fix config
      ansible.builtin.command: dpkg --configure -a
    - name: Reboot the server
      reboot:
    - name: Refresh packages once more
      apt:
        update_cache: yes
        autoclean: yes
        autoremove: yes
        force_apt_get: yes
        force: yes
        install-recommends: no
        purge: yes
        state: build-dep
        upgrade: safe
    - name: custom bashrc
      ansible.builtin.copy:
        src: "{{ playbook_dir | dirname }}/bashrc"
        dest: "/etc/bash.bashrc"
        owner: "root"
        group: "root"
        mode: "0555"